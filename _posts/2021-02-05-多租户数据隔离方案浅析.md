---
layout:     post
title:      多租户数据隔离方案浅析
subtitle:   cloud
date:       2021-02-05
author:     Zjianru
header-img: img/post-bg-desk.jpg
catalog: true
tags:
    - cloud
---
多租户的数据隔离方案，不外乎三种方案：

* 独立数据库

一个租户一个数据库，这种方案的用户数据隔离级别最高，安全性最好，但成本较高

优点： 为不同的租户提供独立的数据库，有助于简化数据模型的扩展设计，满足不同租户的独特需求；如果出现故障，恢复数据比较简单

缺点： 增加数据库安装量，维护成本和购置成本增加
> 与传统的一个客户、一套数据、一套部署类似，差别在于软件统一部署在运营商
>
> 如果面对的是银行、医院等需要非常高数据隔离级别的租户，可以选择这种模式，提高租用的定价
>
> 如果定价较低，产品走低价路线，这种方案一般对运营商来说是无法承受的

* 共享数据库，隔离数据架构

多个或所有租户共享 `DataBase`，但是每个租户一个 `Schema`（`user`）

优点： 为安全性要求较高的租户提供了一定程度的逻辑数据隔离，并不是完全隔离

缺点： 如果出现故障，数据恢复比较困难，因为恢复数据库将牵涉到其他租户的数据；如果需要跨租户统计数据，存在一定困难

* 共享数据库，共享数据架构

租户共享同一个 `DataBase`、同一个 `Schema`，但在表中增加 `corp_code` ( 多租户的数据字段 )
> 共享程度最高、隔离级别最低、维护成本和购置最低的模式
>
> 最适合希望以最少的服务器为最多的租户提供服务，且租户接受牺牲隔离级别换取降低成本

优点： 维护和购置成本最低，跨租户统计方便，允许每个数据库支持的租户数量多

缺点： 隔离级别最低，需要在设计开发时加大对安全的开发量；对单个租户的数据备份和恢复困难
