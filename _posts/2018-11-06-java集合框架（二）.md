---
layout:     post
title:      java 集合框架（二）
subtitle:   由 Collection 接口说开
date:       2018-11-06
author:     Alessio
header-img: img/PostBack_03.jpg
catalog: true
tags:
    - java
    - 集合框架
---

## Collection 接口

在对集合框架做完总体描述之后，我们来详细的看一下 `Collection` 这个接口的内容。

在官方文档中，明确给出了核心的继承关系图，这里也包含了 `Map` 接口的核心继承关系

![The core collection interfaces](https://docs.oracle.com/javase/tutorial/figures/collections/colls-coreInterfaces.gif)

另外。在声明一个 `Collection` 对象的时候，我们使用**泛型**来完成类型的规定 —— 这可以让编译器在程序的编译和运行阶段检查出代码的错误之处

> 有关 `泛型` 的内容 可以移步 [**浅谈 java 泛型**](https://zjianru.top/2018/10/31/%E6%B3%9B%E5%9E%8B/)

在后续的内容中，我们只讨论如何有效的使用一般接口 —— 当差不多了解完这些接口，我们对集合框架的内容就已经基本掌握了

## 接口方法浅析

`Collection` 接口是一个总接口，只规定了一系列的抽象方法，并由另外的子类完成各自的实现：

![Collection 接口方法图](https://raw.githubusercontent.com/Zjianru/zjianru.github.io/master/img/Collection%20%E6%8E%A5%E5%8F%A3%E6%96%B9%E6%B3%95%E5%9B%BE.png)

在图中可以看到两个操作数组的方法：

```java
Object[] toArray();
<T> T[] toArray(T[] a);
```

两个关于流操作（Stream）的方法（ In JDK 8 and later ）：

```java
default Stream<E> stream() {
    return StreamSupport.stream(spliterator(), false);
}   

default Stream<E> parallelStream() {
    return StreamSupport.stream(spliterator(), true);
}
```

包括：

- 添加 Collection 容器内元素的方法，他们旨在向容器内添加元素，保证完成调用之后将会包含指定的元素 —— Collection 会发生变化。如果改变，则会返回 True


```java
boolean add(E e);
boolean addAll(Collection<? extends E> c);
```


- 删除 Collection 容器内元素的方法，他们旨在从 Collection 中删除指定元素，如果它包含要开始的元素，并且如果 Collection 被修改为结果则返回 true

```java
boolean remove(Object o);

boolean removeAll(Collection<?> c);

default boolean removeIf(Predicate<? super E> filter) {
    Objects.requireNonNull(filter);
    boolean removed = false;
    final Iterator<E> each = iterator();
    while (each.hasNext()) {
        if (filter.test(each.next())) {
            each.remove();
            removed = true;
        }
    }
    return removed;
}
```
### 遍历集合

关于遍历集合，我们有三种方式，在这里我们只做简单的介绍：

1. 获取流并使用聚合操作
2. 使用 for 循环 或 for-each 循环
3. 使用迭代器

#### 获取流并使用聚合操作

在 JDK8 之后,官方推荐的方式便是使用流完成对集合的遍历

聚合操作 ( `perform aggregate operations` ) 通常与 lambda 表达式结合使用，以使用较少的代码行使编程更具表现力。这是 JDK8 添加的新特性

以下代码按顺序遍历一组形状并打印出红色对象

```java
myShapesCollection.stream()
.filter(e -> e.getColor() == Color.RED)
.forEach(e -> System.out.println(e.getName()));
```
或者用这样的方式，可以以多线程的方式完成操作

```java
myShapesCollection.parallelStream()
.filter(e -> e.getColor() == Color.RED)
.forEach(e -> System.out.println(e.getName()));
```
想要更深入地了解 Java 8 的流操作，请浏览这里 [**聚合操作 —— java 官方文档**](https://docs.oracle.com/javase/tutorial/collections/streams/index.html)

使用流可以方便地完成批量操作,这与 API 中提供的批量操作方法似乎有些重叠，关于这个问题，官方文档中也有解释：

> The Collections framework has always provided a number of so-called "bulk operations" as part of its API. 
> 
> These include methods that operate on entire collections, such as containsAll, addAll, removeAll, etc.
>  
> Do not confuse those methods with the aggregate operations that were introduced in JDK 8. 
> 
> The key difference between the new aggregate operations and the existing bulk operations (containsAll, addAll, etc.) is that the old versions are all mutative, meaning that they all modify the underlying collection. In contrast, the new aggregate operations do not modify the underlying collection. 

` 新聚合操作与现有批量操作之间的主要区别（containsAll ，addAll等）是旧版本都是变异的，这意味着它们都修改了底层集合`

#### 使用 for 循环 或 for-each 循环

使用 for 或者 for-each 循环完成遍历操作似乎是遍历 Collection 的最基础做法，如下的代码示例将会遍历 Collection 中的所有对象bing进行输出
```java
// for-each
for (Object o : collection)
    System.out.println(o);
// for
for (int i = 0; i < collection.size(); i++) {
    Object object = collection.get(i);
    System.out.println(object);
}
```
#### 使用迭代器

迭代器 (`Iterators` ) 是 java 为遍历所提供的特殊对象。我们可以通过调用 `iterator` 方法获得集合的 `Iterator`。

我们将上面的实例改写成使用 `Iterators` 的方式

```java
List<String> collection = new ArrayList<>();
Iterator iterator = collection.iterator();
while (iterator.hasNext()) {
    System.out.print(iterator.next() + ",");
}
```

实际上 `for-each` 方法是循环的语法糖形式，我们对其进行反编译：

```java
// 反编译前
for (Integer i : list) {
    System.out.println(i);
}
    Integer i;
// 反编译后
for(Iterator iterator = list.iterator(); iterator.hasNext(); System.out.println(i)){
    i = (Integer)iterator.next();        
}
```
至于 更深层次的 `Iterator` 迭代器的使用，请查阅 [ **官方文档** ](https://docs.oracle.com/javase/8/docs/api/java/util/Iterator.html)，在后续内容中我也会针对遍历推出一个专题